<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Blinder Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script
      type="text/javascript"
      src="https://sandbox.web.squarecdn.com/v1/square.js"
    ></script>
</head>
<body class="p-5 bg-white">
  <div class="flex justify-center">
    <img class="ant-image-img" src="https://basicannon.s3.amazonaws.com/blinder+Main+Logo.png" style="height: 30px; width: 104px;">
  </div>
  <div id="step1"
    class="flex flex-col justify-center items-center"
  >
    <p class="text-center">Story is proud to work with Blinder AI to help creators like you to auto file LEGAL copyright protections with the US Copyright Office.</p>
    <div class="max-w-xl mt-4">
      <div class="mb-2">
        <input type="text" id="txt-first-name"
          placeholder="First Name"
          class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
        >
        <div id="error-first-name" class="hidden my-1 block rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10">Please input first name</div>
      </div>
      <div class="mb-2">
        <input type="text" id="txt-last-name"
          placeholder="Last Name"
          class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
        >
        <div id="error-last-name" class="hidden mt-1 block items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10">Please input last name</div>
      </div>
      <div class="mb-2">
        <input type="text" id="txt-login-email"
          placeholder="Email"
          class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
        >
        <div id="error-email" class="hidden mt-1 block items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10">Please input email</div>
      </div>
      <div>
        <button id="btn-login"
        class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800"
        >File for Copyright Protection</button>
      </div>
    </div>
  </div>
  <div id="step2" 
    class="hidden flex flex-col justify-center items-center"
  >
    <div class="max-w-xl mt-4">
      <p>Upload the original work file you want to file for legal copyright protection</p>
      <div class="flex flex-row mt-4">
        <div class="flex-1">
          <input type="file" id="file-input"
            class="w-full text-gray-500 font-medium text-sm bg-gray-100 file:cursor-pointer cursor-pointer file:border-0 file:py-2 file:px-4 file:mr-4 file:bg-gray-800 file:hover:bg-gray-700 file:text-white rounded"
          >
        </div>
        <div class="flex-none w-32">
          <button id="btn-upload-file"
            class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800"
          >upload</button>
        </div>
      </div>
      <div id="wait-upload" class="hidden mt-1 block items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10">Please wait while your file uploads.</div>
      <div id="complete-upload" class="hidden mt-1 block items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/10">Upload completed please go to the next step.</div>
      <div class="flex flex-col justify-center items-center">
        <button id="btn-step2" disabled
        class="disabled:cursor-not-allowed text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800"
        >Next 1/2</button>
      </div>
    </div>
  </div>
  <div id="step3" class="hidden">
    <div class="flex justify-center">
      <p class="text-center">Copyright Registration Information Form</p>
    </div>
    <form id="c-info-form">
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="type_ow" class="text-lg font-bold block">
              1. Type of Work:
            </label>
            <label for="type_ow" class="block">
              Select the type of data you are protecting:
            </label>
          </div>
          <div class="col-span-2">
            <select id="type_ow" name="type_of_work"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
            >
              <option value="CP">Complete Digital Cinema Package</option>
              <option value="VF">Video Files (jpg2000 encoded mxf)</option>
              <option value="AF">Audio Files (5.1, 7.1, atmos)</option>
              <option value="MD">Metadata Files (timed text, etc.)</option>
              <option value="SC">Script</option>
              <option value="DR">Drawing</option>
              <option value="PH">Photograph</option>
              <option value="WW">Written Work</option>
              <option value="OT">Other Media</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="title_ow" class="text-lg font-bold block">
              2. Title of the Work:
            </label>
            <label for="title_ow" class="block">
              Example: The Next Mona Lisa
            </label>
          </div>
          <div class="col-span-2">
            <input type="text" id="title_ow" name="title_ow"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="c_date" class="text-lg font-bold block">
              3. Completion Date:
            </label>
            <label for="c_date" class="block">
              Date of completion.
            </label>
          </div>
          <div class="col-span-2">
            <input type="date" id="c_date" name="c_date"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="published" class="text-lg font-bold block">
              4. Publication Status:
            </label>
            <label for="published">
              Has this work been published?
            </label>
          </div>
          <div class="col-span-2">
            <input type="text" id="published" name="published"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <!-- <div class="grid grid-cols-3 ">
          <div>
            <label for="first_publish">
              Is this first publish?
            </label>
          </div>
          <div class="col-span-2">
            <input type="date" id="first_publish" name="first_publish"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div> -->
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="author_name" class="text-lg font-bold block">
              5. Author information:
            </label>
            <label for="author_name">
              full leagal name of the author(s).
            </label>
          </div>
          <div class="col-span-2">
            <input type="text" id="author_name" name="author_name"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="author_birth">
              Date of birth of the author(s).
            </label>
          </div>
          <div class="col-span-2">
            <input type="date" id="author_birth" name="author_birth"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="author_aim">
              Was the work created as a work for hire? (Was the work created as part of the author's employment?)
            </label>
          </div>
          <div class="col-span-2">
            <input type="date" id="author_aim" name="author_aim"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="crt_owner_name" class="text-lg font-bold block">
              6. Rights Holder Information
            </label>
            <label for="crt_owner_name">
              Who owns the copyright? This could be the author themself or another entity.
            </label>
          </div>
          <div class="col-span-2">
            <input type="text" id="crt_owner_name" name="crt_owner_name"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="crt_owner_fullname">
              Full legal name of the copyright owner(s).
            </label>
          </div>
          <div class="col-span-2">
            <input type="text" id="crt_owner_fullname" name="crt_owner_fullname"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="crt_owner_contact">
              Address and contact information of the copyright owner(s).
            </label>
          </div>
          <div class="col-span-2">
            <input type="text" id="crt_owner_contact" name="crt_owner_contact"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="prev_resigter" class="text-lg font-bold block">
              7. Previous Registrations
            </label>
            <label for="prev_resigter">
              Has this work been registered before?
            </label>
          </div>
          <div class="col-span-2">
            <input type="text" id="prev_resigter" name="prev_resigter"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="is_new" class="text-lg font-bold block">
              8. Claiming New Material
            </label>
            <label for="is_new">
              Are you registering new material that is part of an existing work (e.g., revisions, additional content)?
            </label>
          </div>
          <div class="col-span-2">
            <input type="text" id="is_new" name="is_new"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="nature" class="text-lg font-bold block">
              9. Certification and Signature
            </label>
            <label for="regiterer_fullname">
              Full legal name of the person completing the registration.
            </label>
          </div>
          <div class="col-span-2">
            <input type="text" id="regiterer_fullname" name="regiterer_fullname"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="registerer_relationship">
              Relationship to the author(s) or copyright owner(s) (e.g., author, owner, authorized agent).
            </label>
          </div>
          <div class="col-span-2">
            <input type="text" id="registerer_relationship" name="registerer_relationship"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="signature">
              By inputting your name here, you agree to the agency agreement with Blinder.
            </label>
          </div>
          <div class="col-span-2">
            <input type="text" id="signature" name="signature"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-1">
          <div>
            <label for="date_of_submission">
              Date of submission.
            </label>
          </div>
          <div class="col-span-2">
            <input type="date" id="date_of_submission" name="date_of_submission"
              class="block border border-solid border-slate-300 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 w-full"
             />
          </div>
        </div>
        <div class="grid grid-cols-3 mt-2">
          <div class="col-start-2 col-span-2">
            <input id="chk-confirm" type="checkbox" value="" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
            <label for="chk-confirm" class="ms-2 text-sm font-medium text-gray-900 dark:text-gray-300">Confirm that the information provided is accurate to the best of your knowledge.</label>
          </div>
        </div>
        <div class="grid grid-cols-3 mt-2">
          <div class="col-start-2 col-span-2">
            <input id="chk-confirm2" type="checkbox" value="" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
            <label for="chk-confirm2" class="ms-2 text-sm font-medium text-gray-900 dark:text-gray-300">The services are not legal advice and should not be used a substitute for legal and professional advice and customerâ€™s own judgment.</label>
          </div>
        </div>
        <div class="flex justify-center items-center mt-2">
          <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">Request copyright</button>
        </div>
    </form>
  </div>
  
  <div id="step4" class="hidden">
    <div class="flex justify-center">
      <p class="text-center text-lime-600	text-2xl font-bold ">Congratulation!</p>
    </div>
    <div class="flex justify-center items-center mt-2">
      <button type="button" id="btn-restart" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">Submit again</button>
    </div>
  </div>
    <!-- Main modal -->
    <div id="payment-modal" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-10 flex justify-center items-center w-full h-full overflow-y-auto overflow-x-hidden">
      <div class="fixed inset-0 bg-gray-500 bg-opacity-50"></div>
          <!-- Modal content -->
      <div class="relative w-full max-w-2xl shadow-lg z-10">
          <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
              <!-- Modal header -->
              <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                  <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                      Confirm payment
                  </h3>
                  <button type="button" id="btn-close-modal" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white">
                      <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                      </svg>
                      <span class="sr-only">Close</span>
                  </button>
              </div>
              <!-- Modal body -->
              <form class="p-4 md:p-5">
                <div class="grid gap-4 mb-4 grid-cols-2">
                    <div class="col-span-1">
                        <label for="m-first-name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">First Name</label>
                        <input type="text" name="m-first-name" id="m-first-name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" required="">
                    </div>
                    <div class="col-span-1">
                        <label for="m-last-name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Last Name</label>
                        <input type="text" name="m-last-name" id="m-last-name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" required="">
                    </div>
                    <div class="col-span-2">
                        <label for="m-email" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Email</label>
                        <input type="text" name="m-email" id="m-email" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" required="">
                    </div>
                    <div class="col-span-1">
                        <label for="m-street" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Street</label>
                        <input type="text" name="m-street" id="m-street" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" required="">
                    </div>
                    <div class="col-span-1">
                        <label for="m-city" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">City</label>
                        <input type="text" name="m-city" id="m-city" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" required="">
                    </div>
                </div>
                <div id="card-container"></div>
                <div class="col-start-2 col-span-2">
                  <input id="chk-agree" type="checkbox" value="" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                  <label for="chk-agree" class="ms-2 text-sm font-medium text-gray-900 dark:text-gray-300">I agree to make payment.</label>
                </div>
                <div class="flex flex-col justify-center items-center">
                  <button id="submit-payment" class="text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                      <svg class="me-1 -ms-1 w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"></path></svg>
                      One Time Payment: $99
                  </button>
                </div>
            </form>
          </div>
      </div>
    </div>
    <div id="loader" class="hidden relative group w-full">
      <div class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center opacity-100 transition-opacity duration-300">
        <div class="flex flex-col items-center p-5 bg-white">
          <h1 class="text-2xl font-bold text-center">Please wait.</h1>
          <div class="w-16 h-16 border-4 border-t-transparent border-blue-500 border-solid rounded-full animate-spin"></div>
        </div>
      </div>
    </div>
    <div id="initial-loader" class="fixed group w-full h-full z-50">
      <div class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center opacity-100 transition-opacity duration-300">
        <div class="w-16 h-16 border-4 border-t-transparent border-blue-500 border-solid rounded-full animate-spin"></div>
      </div>
    </div>
    
    <script>
      const appId = 'sandbox-sq0idb-jAkoK78x-mLJIlDc8KYgyg';
      const locationId = 'LQ2PBK3WJQH0P';
      const API_URL = "https://hdztvyc5ga.execute-api.us-east-1.amazonaws.com";

      let gFileContent = null;
      let gFileName = "";
      let gFileType = "";
      let gFileSize = 0;
      let s3StoredPath = "";
      

      async function initializeCard(payments) {
        const card = await payments.card();
        await card.attach('#card-container');

        return card;
      }

      async function createPayment(token, verificationToken) {
        const body = JSON.stringify({
          locationId,
          sourceId: token,
          verificationToken,
          idempotencyKey: window.crypto.randomUUID(),
        });

        const paymentResponse = await fetch('https://hdztvyc5ga.execute-api.us-east-1.amazonaws.com/v1/confirm-payment', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body,
        });

        if (paymentResponse.ok) {
          return paymentResponse.json();
        }

        const errorBody = await paymentResponse.text();
        throw new Error(errorBody);
      }

      async function tokenize(paymentMethod) {
        const tokenResult = await paymentMethod.tokenize();
        if (tokenResult.status === 'OK') {
          return tokenResult.token;
        } else {
          let errorMessage = `Tokenization failed with status: ${tokenResult.status}`;
          if (tokenResult.errors) {
            errorMessage += ` and errors: ${JSON.stringify(
              tokenResult.errors,
            )}`;
          }

          throw new Error(errorMessage);
        }
      }

      // Required in SCA Mandated Regions: Learn more at https://developer.squareup.com/docs/sca-overview
      async function verifyBuyer(payments, token) {
        const verificationDetails = {
          amount: '1.00',
          billingContact: {
            givenName: 'John',
            familyName: 'Doe',
            email: 'john.doe@square.example',
            phone: '3214563987',
            addressLines: ['123 Main Street', 'Apartment 1'],
            city: 'London',
            state: 'LND',
            countryCode: 'GB',
          },
          currencyCode: 'GBP',
          intent: 'CHARGE',
        };

        const verificationResults = await payments.verifyBuyer(
          token,
          verificationDetails,
        );
        return verificationResults.token;
      }

      // status is either SUCCESS or FAILURE;
      function displayPaymentResults(status) {
        const statusContainer = document.getElementById(
          'payment-status-container',
        );
        if (status === 'SUCCESS') {
          statusContainer.classList.remove('is-failure');
          statusContainer.classList.add('is-success');
        } else {
          statusContainer.classList.remove('is-success');
          statusContainer.classList.add('is-failure');
        }

        statusContainer.style.visibility = 'visible';
      }

      async function uploadToS3(url) {
        try {
          const response = await fetch(url, {
            method: 'PUT',
            headers: {
              'Content-Type': gFileType,
            },
            body: gFileContent,
          });
          document.getElementById('btn-upload-file').disabled = false;
          document.getElementById('btn-upload-file').classList.remove("disabled:cursor-not-allowed");
          document.getElementById("wait-upload").classList.add("hidden");
      
          if (response.ok) {
            document.getElementById('complete-upload').classList.remove("hidden");
            document.getElementById('btn-step2').classList.remove("disabled:cursor-not-allowed");
            document.getElementById('btn-step2').disabled = false;
            return true;
          }
          s3StoredPath = url;
          alert('upload error. [TYPE-1]');
        } catch (error) {
          document.getElementById('btn-upload-file').disabled = false;
          document.getElementById('btn-upload-file').classList.remove("disabled:cursor-not-allowed");
          document.getElementById("wait-upload").classList.add("hidden");
          console.error('Error uploading file:', error);
          alert('upload error. [TYPE-2]');
        }
        document.getElementById('wait-upload').classList.add('hidden');
        
        return false;
      }

      document.addEventListener('DOMContentLoaded', async function () {
        const btnLogin = document.getElementById('btn-login');
        const btnUploadFile = document.getElementById('btn-upload-file');
        const btnCompleteUpload = document.getElementById('btn-step2');
        const btnRestart = document.getElementById('btn-restart');
        const fileInput = document.getElementById('file-input');
        
        const copyrightForm = document.getElementById('c-info-form');
        
        const paymentModal = document.getElementById("payment-modal");
        
        const paymentModalCloseBtn = document.getElementById("btn-close-modal");

        const doPayButton = document.getElementById('submit-payment');

        const loader = document.getElementById('loader');
          
        window.addEventListener(
          "message",
          (event) => {
            // if (event.origin !== "https://app.scale-in.com" && event.origin !== "https://backend.scale-in.com") {
            //   return;
            // }
            const param = event.data;
            if (param.type === 'requestPayment') {
              loader.classList.add('hidden');
              paymentModal.classList.remove("hidden");
            } else if (param.type === 'paymentConfirmed') {
              paymentModal.classList.add("hidden");
              document.getElementById("initial-loader").classList.add("hidden");
              document.getElementById('step1').classList.add("hidden");
              document.getElementById('step2').classList.add("hidden");
              document.getElementById('step3').classList.add("hidden");
              document.getElementById('step4').classList.remove("hidden");
              alert(`Your submission is completed. The copyright ID is ${param.data.copyrightID}.`);
            } else if (param.type === 'userLoggedIn') {
              document.getElementById('step1').classList.add("hidden");
              document.getElementById('step2').classList.remove("hidden");
              document.getElementById("initial-loader").classList.add("hidden");
            } else if (param.type === 'createCopyrightError') {
              document.getElementById("loader").classList.add("hidden");
              alert(`Certification create is failed. Please try again.`);
            } else if (param.type === 'loginError') {
              alert(`Login failed, Please contact to the BlinderAI support team.`);
            } else if (param.type === 's3path') {
              if (param.data.success) {
                s3StoredPath = param.data.s3path;
                uploadToS3(param.data.url);
              } else {
                alert(`Upload failed, Please contact to the BlinderAI support team.`);
              }
            }
          },
          false,
        );

        if (!window.Square) {
          throw new Error('Square.js failed to load properly');
        }

        let payments;
        try {
          payments = window.Square.payments(appId, locationId);
        } catch {
          const statusContainer = document.getElementById(
            'payment-status-container',
          );
          statusContainer.className = 'missing-credentials';
          statusContainer.style.visibility = 'visible';
          return;
        }

        let card;
        try {
          card = await initializeCard(payments);
        } catch (e) {
          console.error('Initializing Card failed', e);
          return;
        }

        async function handlePaymentMethodSubmission(event, card) {
          event.preventDefault();

          try {
            // disable the submit button as we await tokenization and make a payment request.
            doPayButton.disabled = true;
            document.getElementById('submit-payment').classList.add("disabled:cursor-not-allowed");
            const token = await tokenize(card);
            const verificationToken = await verifyBuyer(payments, token);
            // const paymentResults = await createPayment(
            //   token,
            //   verificationToken,
            // );
            // displayPaymentResults('SUCCESS');
            return {
              token,
              verificationToken,
            }

            console.debug('Payment Success', paymentResults);
          } catch (e) {
            document.getElementById('submit-payment').classList.remove("disabled:cursor-not-allowed");
            doPayButton.disabled = false;
            // displayPaymentResults('FAILURE');
            console.error(e.message);
          }
          return null;
        }
        doPayButton.addEventListener('click', async function (event) {
          document.getElementById("initial-loader").classList.remove("hidden");
          const result = await handlePaymentMethodSubmission(event, card);
          if (!result) {
            document.getElementById("initial-loader").classList.add("hidden");
            return;
          }
          window.parent.postMessage({
            type: "confirm_payment",
            data: {
              token: result.token,
              verificationToken: result.verificationToken,
              locationId,
            }
          }, '*');
        });
        
        paymentModalCloseBtn.addEventListener('click', function(event) {
          paymentModal.classList.add("hidden");
        });
        
        copyrightForm.addEventListener('submit', function(event) {
          event.preventDefault();
          event.stopPropagation();
          loader.classList.remove('hidden');

          window.parent.postMessage({
            type: "confirm_copyright",
            data: {
              dataType: document.getElementById('type_ow').value,
              titleOfWork: document.getElementById('title_ow').value,
              completionDate: document.getElementById('c_date').value,
              publicationStatus: document.getElementById('published').value,
              firstPublishedInfo: '', // document.getElementById('first_publish').value,
              authorName: document.getElementById('author_name').value,
              authorBirth: document.getElementById('author_birth').value,
              authorCreateAim: document.getElementById('author_aim').value,
              copyrightOwnerName: document.getElementById('crt_owner_name').value,
              copyrightOwnerFullName: document.getElementById('crt_owner_fullname').value,
              copyrightOwnerContactInfo: document.getElementById('crt_owner_contact').value,
              previousRegistration: document.getElementById('prev_resigter').value,
              previousRegistrationInfo: '', //document.getElementById('prev_resigter_info').value,
              isNewMaterial: document.getElementById('is_new').value,
              natureOfMaterial: '',
              registererFullName: document.getElementById('regiterer_fullname').value,
              registererRelationship: document.getElementById('registerer_relationship').value,
              signature: document.getElementById('signature').value,
              dateOfSubmission: document.getElementById('date_of_submission').value,
              fileInfo: {
                storePath: s3StoredPath,
                mType: 'agent',
                meta: gFileName,
                mediaOriginalName: gFileName,
                mediaOriginalExt: gFileType,
                mediaSize: gFileSize,
              }
            },
          }, '*');
            // paymentModal.classList.remove("hidden");
        });

        btnLogin.addEventListener('click', async function (event) {
          const firstName = document.getElementById('txt-first-name').value;
          const lastName = document.getElementById('txt-last-name').value;
          const email = document.getElementById('txt-login-email').value;
          let hasError = false;
          if (firstName.trim() === "") {
            hasError = true;
            document.getElementById('error-first-name').classList.remove('hidden');
          } else {
            document.getElementById('error-first-name').classList.add('hidden');
          }
          if (lastName.trim() === "") {
            hasError = true;
            document.getElementById('error-last-name').classList.remove('hidden');
          } else {
            document.getElementById('error-last-name').classList.add('hidden');
          }
          if (email.trim() === "") {
            hasError = true;
            document.getElementById('error-email').classList.remove('hidden');
          } else {
            document.getElementById('error-email').classList.add('hidden');
          }
          if (hasError) {
            return;
          }
          document.getElementById("initial-loader").classList.remove("hidden");
          window.parent.postMessage({
            type: "login_user",
            data: {
              firstName: firstName,
              lastName: lastName,
              email: email,
            }
          }, '*');
        });

        fileInput.addEventListener("change", async (event) => {
          const file = event.target.files[0];  // Get the selected file (image)

          document.getElementById('btn-step2').classList.add("disabled:cursor-not-allowed");
          document.getElementById('btn-step2').disabled = true;
          document.getElementById('complete-upload').classList.add("hidden");
          
          
          if (!file) return;  // If no file is selected, return early

          gFileContent = file instanceof Blob ? file : new Blob([file], { type: file.type });
          gFileName = file.name;
          gFileType = file.type;
          gFileSize = file.size;
        });

        btnUploadFile.addEventListener('click', function () {
          btnUploadFile.disabled = true;
          document.getElementById('btn-upload-file').classList.add("disabled:cursor-not-allowed");
          document.getElementById("wait-upload").classList.remove("hidden");
          window.parent.postMessage({
            type: "request_s3path",
            data: {
              filename: gFileName,
              filetype: gFileType,
            }
          }, '*');
        });

        btnCompleteUpload.addEventListener('click', function () {
          document.getElementById('step1').classList.add("hidden");
          document.getElementById('step2').classList.add("hidden");
          document.getElementById('step3').classList.remove("hidden");
        });

        btnRestart.addEventListener('click', function() {    
          gFileContent = null;
          gFileName = "";
          gFileType = "";
          gFileSize = 0;
          s3StoredPath = "";
          document.getElementById('complete-upload').classList.add("hidden");
          document.getElementById('btn-upload-file').classList.remove("disabled:cursor-not-allowed");
          document.getElementById('btn-upload-file').disabled = false;
          document.getElementById('btn-step2').classList.add("disabled:cursor-not-allowed");
          document.getElementById('btn-step2').disabled = true;
          document.getElementById('submit-payment').classList.remove("disabled:cursor-not-allowed");
          document.getElementById('submit-payment').disabled = false;
          
          document.getElementById('step1').classList.add("hidden");
          document.getElementById('step2').classList.remove("hidden");
          document.getElementById('step3').classList.add("hidden");
          document.getElementById('step4').classList.add("hidden");
        })

        document.getElementById("initial-loader").classList.add("hidden");
      });
      
    </script>
</body>
</html>